#!/bin/bash

TEST=$1
LOG=$2
# PREDIFF: Script to execute before diff'ing output (arguments: <test
#    executable>, <log>, <compiler executable>)

MYLOG=""
LAST=""
FOUND_MARKER=0

while read line || [[ -n $line ]];
do
  # skip until we find "compiling generated source" line
  if [[ $line == *"compiling generated source"* ]]; then
    FOUND_MARKER=1
  fi
  if [ $FOUND_MARKER -ne 1 ]; then continue; fi

  for word in $line
    do
      if [[ $word == "-Ltest-"* ]]
        then
          if [[ $word != $LAST ]]
            then
              MYLOG+=" $word"
              LAST=$word
            fi
        fi
  done
done <<< "$(cat $LOG)"

echo $MYLOG > $LOG
