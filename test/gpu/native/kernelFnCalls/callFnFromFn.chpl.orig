<<<<<<< HEAD
use GpuDiagnostics;
=======
use GPUDiagnostics;

proc verifyLaunches() {
  use ChplConfig;
  param expected = if CHPL_GPU_MEM_STRATEGY == "unified_memory" then 1 else 2;
  const actual = getGPUDiagnostics()[0].kernel_launch;
  assert(actual == expected,
         "observed ", actual, " launches instead of ", expected);
}

>>>>>>> 87bc8d4283 (Adjust tests that were sensitive to number of kernel launches)
config const n = 10;

proc foo(i) {
  return 1 + bar(i);
}

proc bar(i) {
  return i / 2;
}

startGpuDiagnostics();
on here.gpus[0] {
  var A: [0..#n] int;

  forall i in 0..#n {
    A[i] = foo(i);
  }

  writeln(A);
}
<<<<<<< HEAD
stopGpuDiagnostics();
writeln(getGpuDiagnostics());
=======
stopGPUDiagnostics();
verifyLaunches();
>>>>>>> 87bc8d4283 (Adjust tests that were sensitive to number of kernel launches)

var x = foo(13);
writeln(x);
