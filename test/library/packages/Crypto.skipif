#!/usr/bin/env python3

import os
import subprocess
from pkg_resources import parse_version


platform = os.getenv('CHPL_TARGET_PLATFORM')

Ok = False

if platform != 'linux64':
    Ok = False  # not linux
else:
    sub = subprocess.run(['pkg-config', '--modversion', 'libcrypto'],
                         capture_output=True)
    if sub.returncode == 0:
        v = sub.stdout
        v = v.strip()
        v = str(v, encoding='utf-8', errors='surrogateescape')
        if v == "1.1.1k" or parse_version(v) >= parse_version('1.1'):
            # OK, version is compatible.
            Ok = True

print(not Ok)
