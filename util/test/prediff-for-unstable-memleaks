#!/usr/bin/env python3

# want to eliminate the message
# `<command-line arg>:n: warning: The variable 'memLeaks' is unstable and its interface is subject to change in the future`
# from tests that don't normally provide it when in the general memleaks config

import sys

testname = sys.argv[1]
outfile = sys.argv[2]

# note: assumes that no `--warn-unstable` test that intentionally throws
# `--memLeaks` has an unusually-named `.good` file
goodfile = testname+'.good'

memleaksWarn = "warning: The variable 'memLeaks' is unstable and its interface is subject to change in the future"

foundInGood = False

with open(goodfile, 'r') as gf:
     for line in gf.readlines():
         if line.find(memleaksWarn) != -1:
            foundInGood = True

# If the .good file we checked already has this message, don't remove it
if not foundInGood:
   with open(outfile, 'r') as outR:
      myLines = outR.readlines()

   with open(outfile, 'w') as overwrite:
        for line in myLines:
            if line.find(memleaksWarn) == -1:
               overwrite.write(line)
